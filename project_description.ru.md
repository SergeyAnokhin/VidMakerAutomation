### Часть 1: Описание Проекта

Проект представляет собой приложение на Python для автоматизированного создания видеороликов на основе аудиофайлов и изображений, организованных по директориям. Приложение построено на принципе блочной архитектуры, что позволяет гибко управлять последовательностью конвертеров и конфигурацией обработки.

Основные возможности приложения:
1. **Гибкость и модульность**: Приложение использует набор конвертеров, которые можно легко добавлять, убирать или менять местами, управляя всем процессом через конфигурационный файл в формате YAML. Такая структура делает приложение легко настраиваемым для различных целей.
2. **Универсальная обработка медиафайлов**: Приложение поддерживает обработку аудио и изображений, создание слайд-шоу, добавление текстовых и графических элементов, а также применение аудиовизуализации.
3. **Оптимизация обработки**: Использование многопоточности позволяет обрабатывать части видео параллельно, что значительно сокращает время обработки при использовании сложных эффектов и конвертаций.
4. **Поддержка сложных конфигураций**: В конфигурационном файле YAML можно задавать параметры для каждой задачи и конвертера, используя ссылки для исключения дублирования данных. Это даёт возможность гибко настроить каждый элемент видео, включая порядок конвертеров, продолжительность отображения, позиции и параметры эффектов.

Приложение идеально подходит для автоматизации создания видеоконтента, будь то короткие ролики для социальных сетей, слайд-шоу, или полноценные музыкальные клипы с визуальными эффектами, адаптированными под аудиодорожку.

### Часть 2: Архитектура и Основные Компоненты

#### Иерархия и Структура Обработки

1. **Директории**:
   - Приложение обрабатывает данные из каталогов, содержащих аудиофайлы, изображения и конфигурационные файлы. Директории имеют имена, содержащие слово `clip` (например, clip1, clip2 и т.д.).
   - В каждой директории должны быть:
     - Аудиофайл формата mp3.
     - Набор изображений для создания слайд-шоу.
     - Конфигурационный файл `config.yaml` в формате YAML, который задаёт параметры обработки для данной директории.

2. **Конфигурационный файл (config.yaml)**:
   - В конфигурации указывается последовательность задач и конвертеров, настройки каждого конвертера, а также параметры отображения текста, изображений и аудиовизуализации.
   - **Поддержка ссылок в YAML** позволяет избежать дублирования данных при создании схожих конфигураций, что особенно полезно при настройке для нескольких роликов, таких как основное видео и короткий формат (shorts).
   - **Примеры настроек**:
     - Порядок выполнения задач и конвертеров.
     - Длительность показа каждого изображения, параметры аудиофрагментов.
     - Настройка пресетов качества для финального видео и другие параметры, такие как частота кадров и используемый кодек.

3. **Задачи и Конвертеры**:
   - Каждая директория содержит одну или несколько задач, выполняемых **последовательно**. В конфигурационном файле можно указать, какие конвертеры использовать для каждой задачи и их последовательность.
   - **Блочная архитектура** позволяет гибко задавать конвертеры и управлять ими. Каждый конвертер выполняет определённую функцию (например, создание слайд-шоу, добавление текста или статичных изображений) и наследуется от базового абстрактного класса с функцией `Convert`.
   - Конвертеры работают с **общим объектом метаданных**, позволяющим передавать информацию (например, длительность, название файла) между конвертерами без передачи крупных данных, таких как сами видеоклипы.

### Часть 3: Конвертеры и Их Функциональность

Каждый конвертер в приложении наследуется от базового абстрактного класса и использует функцию `Convert` для обработки клипов и обмена метаданными. Конвертеры выполняют задачи последовательно в рамках указанной последовательности, что позволяет гибко адаптировать процесс создания видео под нужды пользователя.

#### Список Конвертеров

1. **Универсальный Аудиоконвертер (Audio Reader / Universal Audio Converter)**:
   - Находит mp3 файл в директории и создаёт видеоклип на его основе. 
   - Если на входе уже есть видеоклип, конвертер заменяет его аудиодорожку на найденное аудио, устраняя возможные звуковые артефакты.

2. **Слайд-шоу Конвертер (Slideshow Creator)**:
   - Создаёт слайд-шоу из изображений с возможностью автоматического повторения слайд-шоу, если длительность изображений короче аудиофайла.
   - Поддерживает настройку высоты изображений с сохранением пропорций и плавные переходы (fade-in, fade-out) между кадрами.

3. **Текстовый Конвертер (Text Overlay Converter)**:
   - Добавляет текстовые элементы на видео с настройкой позиции, стиля, размера и времени отображения. Поддерживает эффекты плавного появления и исчезновения.

4. **Конвертер Статических Изображений (Image Overlay Converter)**:
   - Добавляет статические или анимированные изображения на видео, с возможностью задавать их позиции и время показа (с опцией отсчёта от конца видео).

5. **Конвертер Разрезки (Split Converter)**:
   - Разделяет видеоклип на части для параллельной обработки. Количество частей указывается в конфигурационном файле.

6. **Аудиовизуализационный Конвертер (Audio Visualization)**:
   - Добавляет визуализацию аудио с динамическими столбиками, расположенными по верхнему краю изображения. Пользователь может задавать количество столбиков, их высоту и цветовую палитру.

7. **Конвертер Склейки (Join Converter)**:
   - Объединяет части видео в единый клип. Сохраняет каждый фрагмент на диск, затем склеивает их в одно видео, добавляя новую аудиодорожку для целостности.

8. **Конвертер для Сохранения Видео (Video Export Converter)**:
   - Сохраняет видеоклип в формате MP4 с настраиваемыми параметрами качества, частоты кадров и кодеком.

---

Эта последовательность обеспечивает полноценный процесс создания видео, от начальной загрузки аудиофайлов и изображений до финального рендеринга видеофайла с оптимальным качеством.

### Часть 4: Логи и Отладка

Для удобства отладки и структурирования логов приложение использует библиотеки **Rich** и **Icecream**, а также общий объект метаданных для обмена вспомогательной информацией между конвертерами. Эти элементы помогают улучшить читаемость и управляемость логов, делая процесс отладки более прозрачным.

#### Библиотеки для Логов и Отладки

1. **Icecream**:
   - Используется для вывода промежуточных данных и значений переменных, что позволяет отслеживать ход выполнения программы и анализировать состояние приложения на каждом этапе.
   - Эта библиотека выводит на экран значения в удобочитаемом формате, особенно полезна для проверки корректности данных, передаваемых между конвертерами.

2. **Rich**:
   - Позволяет форматировать вывод с помощью таблиц, цвета и различных визуальных элементов, улучшая восприятие логов.
   - Например, можно использовать Rich для вывода табличных данных, таких как список изображений и их параметры (размер, позиция и длительность отображения). Это делает информацию наглядной и помогает быстро найти нужные данные.
   - В консоли добавляются цветовые акценты для обозначения разных уровней обработки, что позволяет легче ориентироваться в структуре логов.

#### Форматирование Логов

Для удобства чтения логи организованы с учетом иерархии обработки:

- **Уровень Директории** — основной уровень, представляющий базовые данные для каждой обрабатываемой директории.
- **Уровень Задач** — каждый шаг обработки задачи сдвигается на два пробела, чтобы выделить его от базового уровня.
- **Уровень Конвертеров** — дополнительные отступы на два пробела для каждого конвертера, чтобы выделить последовательность конвертеров внутри задачи.

#### Общий Объект Метаданных

Приложение использует **общий объект метаданных**, передаваемый через функцию `Convert`, для обмена вспомогательной информацией между конвертерами. Этот объект:

- Представляет собой словарь, где ключи — это строки, а значения могут быть любого типа (`any`), но не содержат крупные объекты, такие как клипы или изображения.
- Применяется для хранения таких данных, как:
  - Длительность аудио или видео.
  - Название текущего обрабатываемого файла.
  - Другие вспомогательные данные, которые могут потребоваться конвертерам для выполнения своих задач.
  
Такой подход позволяет передавать важную информацию между этапами обработки без необходимости дублирования данных, сохраняя их в одном месте.

